<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nurse Florence - Clinical Decision Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .chat-message { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .typing-indicator { animation: typing 1.5s infinite; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        .clinical-card { transition: all 0.2s ease; }
        .clinical-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-600 p-3 rounded-xl">
                        <i class="fas fa-user-nurse text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">AI Nurse Florence</h1>
                        <p class="text-sm text-blue-600 font-medium">Clinical Decision Support System</p>
                    </div>
                </div>
                
                <!-- Header Controls -->
                <div class="flex items-center space-x-4">
                    <!-- Connection Status -->
                    <div id="connectionStatus" class="flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg">
                        <div class="w-3 h-3 bg-gray-400 rounded-full pulse-dot"></div>
                        <span class="text-sm text-gray-600 font-medium">Connecting...</span>
                    </div>
                    
                    <!-- Language Selector -->
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-globe text-gray-500"></i>
                        <select id="languageSelector" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white">
                            <option value="en">English</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                            <option value="de">Deutsch</option>
                            <option value="it">Italiano</option>
                            <option value="pt">Português</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-6xl mx-auto px-4 py-6">
        
        <!-- Welcome Banner (shown initially) -->
        <div id="welcomeBanner" class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-lg text-white p-8 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <h2 class="text-2xl font-bold mb-2">Welcome to Your Clinical Assistant</h2>
                    <p class="text-blue-100 mb-4">Get evidence-based support for patient care, medication guidance, and clinical protocols</p>
                    
                    <!-- Compliance Notice -->
                    <div class="bg-blue-500/30 border border-blue-400/30 rounded-lg p-4 mb-4">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-shield-alt text-blue-200 mt-1"></i>
                            <div class="text-sm">
                                <p class="font-semibold text-blue-100 mb-1">Clinical Decision Support Tool</p>
                                <p class="text-blue-200">Educational and reference purposes only. Always follow your institution's protocols and verify all clinical decisions with appropriate healthcare professionals. No PHI is stored or processed.</p>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="startClinicalChat()" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 transition-colors flex items-center space-x-2">
                        <i class="fas fa-comments"></i>
                        <span>Start Clinical Chat</span>
                    </button>
                </div>
                
                <div class="hidden lg:block">
                    <div class="text-right">
                        <div class="bg-white/10 rounded-lg p-4 backdrop-blur">
                            <div class="text-3xl font-bold">v2.0.1</div>
                            <div class="text-blue-200 text-sm">Evidence-Based</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clinical Dashboard - Dedicated Feature Access -->
        <div class="space-y-8">
            
            <!-- Clinical Tools Section -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-stethoscope text-blue-600 mr-3"></i>
                    Clinical Decision Support Tools
                </h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Chat Interface -->
                    <button onclick="startClinicalChat()" class="clinical-feature-btn bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-comments text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Clinical Chat</h3>
                            <p class="text-sm opacity-90">AI-powered clinical decision support</p>
                        </div>
                    </button>

                    <!-- Disease Lookup -->
                    <button onclick="openDedicatedInterface('disease-lookup.html')" class="clinical-feature-btn bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-search-plus text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Disease Lookup</h3>
                            <p class="text-sm opacity-90">Search disease information & symptoms</p>
                        </div>
                    </button>

                    <!-- Drug Interactions -->
                    <button onclick="openDedicatedInterface('drug-interactions.html')" class="clinical-feature-btn bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl hover:from-purple-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-pills text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Drug Interactions</h3>
                            <p class="text-sm opacity-90">Check medication interactions</p>
                        </div>
                    </button>

                    <!-- Clinical Workspace -->
                    <button onclick="openDedicatedInterface('clinical-workspace.html')" class="clinical-feature-btn bg-gradient-to-r from-teal-500 to-teal-600 text-white p-6 rounded-xl hover:from-teal-600 hover:to-teal-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-laptop-medical text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Clinical Workspace</h3>
                            <p class="text-sm opacity-90">Integrated clinical tools dashboard</p>
                        </div>
                    </button>

                    <!-- Assessment Optimizer -->
                    <button onclick="openDedicatedInterface('clinical-assessment-optimizer.html')" class="clinical-feature-btn bg-gradient-to-r from-indigo-500 to-indigo-600 text-white p-6 rounded-xl hover:from-indigo-600 hover:to-indigo-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-brain text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Assessment Optimizer</h3>
                            <p class="text-sm opacity-90">Enhanced clinical assessment tools</p>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Clinical Wizards Section -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-magic text-purple-600 mr-3"></i>
                    Clinical Wizards & Workflows
                </h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- SBAR Wizard -->
                    <button onclick="openDedicatedInterface('sbar-wizard.html')" class="clinical-feature-btn bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-comments-medical text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">SBAR Wizard</h3>
                            <p class="text-sm opacity-90">Structured clinical communication</p>
                        </div>
                    </button>

                    <!-- Care Plan Wizard -->
                    <button onclick="openDedicatedInterface('care-plan-wizard.html')" class="clinical-feature-btn bg-gradient-to-r from-emerald-500 to-emerald-600 text-white p-6 rounded-xl hover:from-emerald-600 hover:to-emerald-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-clipboard-check text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Care Plan Wizard</h3>
                            <p class="text-sm opacity-90">Evidence-based care planning</p>
                        </div>
                    </button>

                    <!-- Clinical Assessment Wizard -->
                    <button onclick="openWizardInterface('clinical_assessment')" class="clinical-feature-btn bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-xl hover:from-red-600 hover:to-red-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-user-check text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Clinical Assessment</h3>
                            <p class="text-sm opacity-90">Comprehensive patient assessment</p>
                        </div>
                    </button>

                    <!-- Medication Reconciliation Wizard -->
                    <button onclick="openWizardInterface('medication_reconciliation')" class="clinical-feature-btn bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-prescription-bottle-alt text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Medication Reconciliation</h3>
                            <p class="text-sm opacity-90">Safe medication management</p>
                        </div>
                    </button>

                    <!-- Patient Education Wizard -->
                    <button onclick="openWizardInterface('patient_education')" class="clinical-feature-btn bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-6 rounded-xl hover:from-yellow-600 hover:to-yellow-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-graduation-cap text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Patient Education</h3>
                            <p class="text-sm opacity-90">Structured patient teaching</p>
                        </div>
                    </button>

                    <!-- Quality Improvement Wizard -->
                    <button onclick="openWizardInterface('quality_improvement')" class="clinical-feature-btn bg-gradient-to-r from-pink-500 to-pink-600 text-white p-6 rounded-xl hover:from-pink-600 hover:to-pink-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-chart-line text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Quality Improvement</h3>
                            <p class="text-sm opacity-90">Process improvement initiatives</p>
                        </div>
                    </button>

                    <!-- Dosage Calculation Wizard -->
                    <button onclick="openWizardInterface('dosage_calculation')" class="clinical-feature-btn bg-gradient-to-r from-cyan-500 to-cyan-600 text-white p-6 rounded-xl hover:from-cyan-600 hover:to-cyan-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-calculator text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Dosage Calculator</h3>
                            <p class="text-sm opacity-90">Step-by-step medication calculations</p>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Emergency & Critical Care Section -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <i class="fas fa-ambulance text-red-600 mr-3"></i>
                    Emergency & Critical Care
                </h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Emergency Assessment -->
                    <button onclick="quickClinicalQuery('Emergency assessment protocols for sepsis recognition and qSOFA scoring')" class="clinical-feature-btn bg-gradient-to-r from-red-500 to-red-600 text-white p-6 rounded-xl hover:from-red-600 hover:to-red-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Sepsis Assessment</h3>
                            <p class="text-sm opacity-90">Emergency protocols & qSOFA</p>
                        </div>
                    </button>

                    <!-- Medication Safety -->
                    <button onclick="quickClinicalQuery('Safe medication administration protocols and dosage calculations')" class="clinical-feature-btn bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-calculator text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Dosage Calculations</h3>
                            <p class="text-sm opacity-90">Safe medication dosing</p>
                        </div>
                    </button>

                    <!-- Pain Management -->
                    <button onclick="quickClinicalQuery('Pain assessment scales and management protocols for acute and chronic pain')" class="clinical-feature-btn bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-hand-holding-heart text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Pain Management</h3>
                            <p class="text-sm opacity-90">Assessment & protocols</p>
                        </div>
                    </button>

                    <!-- Fall Prevention -->
                    <button onclick="quickClinicalQuery('Fall risk assessment tools and prevention strategies for hospitalized patients')" class="clinical-feature-btn bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-6 rounded-xl hover:from-yellow-600 hover:to-yellow-700 transition-all duration-200 transform hover:scale-105 shadow-lg">
                        <div class="text-center">
                            <i class="fas fa-shield-alt text-3xl mb-3"></i>
                            <h3 class="font-bold text-lg mb-2">Fall Prevention</h3>
                            <p class="text-sm opacity-90">Risk assessment & safety</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Interface (hidden initially) -->
        <div id="chatInterface" class="hidden">
            <!-- Chat Header -->
            <div class="bg-white rounded-t-xl shadow-lg p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-600 p-2 rounded-lg">
                            <i class="fas fa-user-nurse text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">Clinical Decision Support</h3>
                            <p class="text-sm text-gray-600">Evidence-based nursing guidance</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="showDashboard()" class="text-gray-600 hover:text-blue-600 transition-colors">
                            <i class="fas fa-home mr-2"></i>Dashboard
                        </button>
                        <button onclick="clearChat()" class="text-gray-600 hover:text-red-600 transition-colors">
                            <i class="fas fa-trash-alt mr-2"></i>Clear Chat
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="bg-white shadow-lg">
                <div id="chatMessages" class="h-96 overflow-y-auto p-6 space-y-4">
                    <!-- Messages will be inserted here -->
                </div>
                
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-6 py-2 border-t border-gray-100">
                    <div class="flex items-center space-x-2 text-gray-500">
                        <div class="typing-indicator">
                            <i class="fas fa-circle text-xs"></i>
                            <i class="fas fa-circle text-xs mx-1"></i>
                            <i class="fas fa-circle text-xs"></i>
                        </div>
                        <span class="text-sm">Florence is analyzing...</span>
                    </div>
                </div>
            </div>
                
            <!-- Input Area -->
            <div class="bg-white rounded-b-xl shadow-lg p-6 border-t border-gray-200">
                <div class="flex space-x-4">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Ask about patient assessment, medications, procedures, or clinical protocols..."
                        class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                        onkeypress="handleKeyPress(event)"
                    >
                    <button 
                        id="sendButton"
                        onclick="sendMessage()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg transition-colors duration-200 flex items-center space-x-2 font-medium"
                    >
                        <i class="fas fa-paper-plane"></i>
                        <span>Send</span>
                    </button>
                </div>
                
                <!-- Clinical Quick Actions -->
                <div class="mt-4">
                    <p class="text-xs text-gray-500 mb-2 font-medium">QUICK CLINICAL ACTIONS:</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="quickClinicalQuery('Signs and symptoms of sepsis with qSOFA scoring')" class="bg-red-100 text-red-700 px-3 py-2 rounded-lg text-xs hover:bg-red-200 transition-colors font-medium">
                            <i class="fas fa-thermometer-half mr-1"></i>Sepsis Assessment
                        </button>
                        <button onclick="quickClinicalQuery('Medication calculation: safe dosing and administration')" class="bg-blue-100 text-blue-700 px-3 py-2 rounded-lg text-xs hover:bg-blue-200 transition-colors font-medium">
                            <i class="fas fa-calculator mr-1"></i>Dosage Calc
                        </button>
                        <button onclick="quickClinicalQuery('Pain assessment scales and management protocols')" class="bg-orange-100 text-orange-700 px-3 py-2 rounded-lg text-xs hover:bg-orange-200 transition-colors font-medium">
                            <i class="fas fa-hand-holding-heart mr-1"></i>Pain Management
                        </button>
                        <button onclick="quickClinicalQuery('Fall risk assessment and prevention strategies')" class="bg-yellow-100 text-yellow-700 px-3 py-2 rounded-lg text-xs hover:bg-yellow-200 transition-colors font-medium">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Fall Prevention
                        </button>
                        <button onclick="quickClinicalQuery('Wound assessment and dressing selection guidelines')" class="bg-green-100 text-green-700 px-3 py-2 rounded-lg text-xs hover:bg-green-200 transition-colors font-medium">
                            <i class="fas fa-band-aid mr-1"></i>Wound Care
                        </button>
                        <button onclick="quickClinicalQuery('IV therapy: insertion, maintenance, and complications')" class="bg-purple-100 text-purple-700 px-3 py-2 rounded-lg text-xs hover:bg-purple-200 transition-colors font-medium">
                            <i class="fas fa-syringe mr-1"></i>IV Therapy
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">
                    <p class="font-medium">AI Nurse Florence v2.0.1</p>
                    <p class="text-xs text-gray-500 mt-1">Clinical Decision Support System</p>
                </div>
                <div class="flex items-center space-x-4 text-xs text-gray-500">
                    <span><i class="fas fa-shield-alt mr-1"></i>Evidence-Based</span>
                    <span><i class="fas fa-user-graduate mr-1"></i>Educational Tool</span>
                    <span><i class="fas fa-lock mr-1"></i>No PHI Stored</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Configuration - Update this to match your Railway deployment
        const API_BASE_URL = window.location.origin + '/api/v1';
        let currentLanguage = 'en';

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkApiConnection();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('languageSelector').addEventListener('change', function(e) {
                currentLanguage = e.target.value;
                addSystemMessage(`Language changed to ${getLanguageName(e.target.value)}`);
            });
        }

        // Check API connection
        async function checkApiConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (data.status === 'operational') {
                    updateConnectionStatus('connected', 'System Online');
                } else {
                    throw new Error('API not operational');
                }
            } catch (error) {
                console.error('API connection failed:', error);
                updateConnectionStatus('error', 'System Offline');
            }
        }

        // Update connection status
        function updateConnectionStatus(status, text) {
            const statusEl = document.getElementById('connectionStatus');
            const dot = statusEl.querySelector('.pulse-dot');
            const span = statusEl.querySelector('span');
            
            dot.className = 'w-3 h-3 rounded-full pulse-dot';
            statusEl.className = 'flex items-center space-x-2 px-3 py-2 rounded-lg';
            
            switch (status) {
                case 'connected':
                    dot.classList.add('bg-green-500');
                    span.textContent = text;
                    span.className = 'text-sm text-green-700 font-medium';
                    statusEl.classList.add('bg-green-50');
                    break;
                case 'error':
                    dot.classList.add('bg-red-500');
                    span.textContent = text;
                    span.className = 'text-sm text-red-700 font-medium';
                    statusEl.classList.add('bg-red-50');
                    break;
                default:
                    dot.classList.add('bg-gray-400');
                    span.textContent = text;
                    span.className = 'text-sm text-gray-600 font-medium';
                    statusEl.classList.add('bg-gray-50');
            }
        }

        // Start clinical chat
        function startClinicalChat() {
            document.getElementById('welcomeBanner').classList.add('hidden');
            document.getElementById('quickAccessSection').classList.add('hidden');
            document.getElementById('chatInterface').classList.remove('hidden');
            
            // Add clinical welcome message
            addAssistantMessage("Hello! I'm AI Nurse Florence, your clinical decision support assistant. I'm here to help with evidence-based nursing guidance, patient assessment protocols, medication safety, and clinical decision-making.\n\nI can assist with:\n• Patient assessment and monitoring\n• Medication calculations and safety\n• Clinical protocols and procedures\n• Documentation and communication\n• Emergency response protocols\n\nWhat clinical question can I help you with today?");
            
            // Focus the input
            document.getElementById('messageInput').focus();
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('welcomeBanner').classList.remove('hidden');
            document.getElementById('quickAccessSection').classList.remove('hidden');
            document.getElementById('chatInterface').classList.add('hidden');
            clearChatMessages();
        }

        // Clear chat
        function clearChat() {
            clearChatMessages();
            addAssistantMessage("Chat cleared. How can I assist you with your clinical practice today?");
        }

        // Clear chat messages
        function clearChatMessages() {
            document.getElementById('chatMessages').innerHTML = '';
        }

        // Add assistant message
        function addAssistantMessage(content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex justify-start mb-6';
            
            messageDiv.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg px-4 py-3 max-w-4xl">
                    <div class="flex items-center mb-2">
                        <div class="bg-blue-600 p-1 rounded-full mr-2">
                            <i class="fas fa-user-nurse text-white text-xs"></i>
                        </div>
                        <span class="text-xs text-blue-700 font-medium">AI Nurse Florence</span>
                        <span class="text-xs text-gray-500 ml-2">Clinical Assistant</span>
                    </div>
                    <div class="text-sm text-gray-800 whitespace-pre-line">${content}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Add user message
        function addUserMessage(content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex justify-end mb-6';
            
            messageDiv.innerHTML = `
                <div class="bg-blue-600 text-white rounded-lg px-4 py-3 max-w-md">
                    <div class="flex items-center justify-end mb-2">
                        <span class="text-xs text-blue-100 mr-2">Nurse</span>
                        <div class="bg-blue-500 p-1 rounded-full">
                            <i class="fas fa-user text-white text-xs"></i>
                        </div>
                    </div>
                    <p class="text-sm">${content}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Add system message
        function addSystemMessage(content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex justify-center mb-4';
            
            messageDiv.innerHTML = `
                <div class="bg-gray-100 text-gray-700 rounded-full px-4 py-2 text-xs">
                    <i class="fas fa-info-circle mr-1"></i>${content}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Handle key press in input
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Quick clinical query
        function quickClinicalQuery(query) {
            if (document.getElementById('chatInterface').classList.contains('hidden')) {
                startClinicalChat();
                setTimeout(() => {
                    document.getElementById('messageInput').value = query;
                    sendMessage();
                }, 100);
            } else {
                document.getElementById('messageInput').value = query;
                sendMessage();
            }
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addUserMessage(message);
            
            // Clear input and disable send button
            input.value = '';
            sendButton.disabled = true;
            sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Analyzing...</span>';
            
            // Show typing indicator
            document.getElementById('typingIndicator').classList.remove('hidden');
            
            try {
                // Try to make real API call first
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        language: currentLanguage
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    addAssistantMessage(data.response || data.message || 'Response received');
                } else {
                    throw new Error('API call failed');
                }
                
            } catch (error) {
                console.warn('API call failed, using simulated response:', error);
                // Fall back to simulated response for testing
                await simulateClinicalApiCall(message);
            } finally {
                // Re-enable send button and hide typing indicator
                sendButton.disabled = false;
                sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span>Send</span>';
                document.getElementById('typingIndicator').classList.add('hidden');
                input.focus();
            }
        }

        // Simulate clinical API call with nursing-specific responses (for testing when API is not ready)
        async function simulateClinicalApiCall(message) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    let response = generateClinicalResponse(message);
                    addAssistantMessage(response);
                    resolve();
                }, 1500);
            });
        }

        // Generate clinical response for testing
        function generateClinicalResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('sepsis')) {
                return "**Sepsis Recognition & Response Protocol:**\n\n**qSOFA Screening (≥2 points suggests sepsis):**\n• Altered mental status (GCS <15)\n• Systolic BP ≤100 mmHg\n• Respiratory rate ≥22/min\n\n**SIRS Criteria (≥2 suggests infection):**\n• Temperature >38°C or <36°C\n• Heart rate >90 bpm\n• Respiratory rate >20/min\n• WBC >12,000 or <4,000\n\n**Immediate Nursing Actions:**\n1. Obtain blood cultures before antibiotics\n2. Start broad-spectrum antibiotics within 1 hour\n3. Administer 30ml/kg crystalloid if hypotensive\n4. Monitor lactate levels\n5. Ensure adequate oxygenation\n6. Frequent vital signs and neurological checks\n\n**Critical Alert:** Activate sepsis protocol and notify physician immediately for any positive screening.";
                        
            } else if (lowerMessage.includes('medication') || lowerMessage.includes('dosage')) {
                return "**Medication Safety & Calculation Protocol:**\n\n**Five Rights of Medication Administration:**\n• Right Patient (2 identifiers)\n• Right Drug (generic & brand names)\n• Right Dose (calculate and verify)\n• Right Route (PO, IV, IM, SQ, etc.)\n• Right Time (scheduled vs PRN)\n\n**Dosage Calculation Formula:**\n**Dose = (Desired dose × Volume) ÷ Stock strength**\n\nExample: Order 400mg, Stock 200mg/5ml\n= (400 × 5) ÷ 200 = 10ml\n\n**Critical Safety Checks:**\n1. Verify allergies and contraindications\n2. Check drug interactions\n3. Assess patient's current condition\n4. Double-check high-risk medications\n5. Monitor for adverse effects\n6. Document immediately after administration\n\n**High-Alert Medications:** Always use independent double-checks for insulin, heparin, chemotherapy, and vasoactive drugs.";
                        
            } else {
                return `I understand you're asking about "${message}". As your AI healthcare assistant, I'd be happy to provide evidence-based information. Could you provide more specific details about what aspect you'd like me to focus on? This helps me give you the most relevant and useful information for your nursing practice.\n\n**Note:** This is a testing prototype. The API will provide more comprehensive responses when fully connected.`;
            }
        }

        // Get language name
        function getLanguageName(code) {
            const languages = {
                'en': 'English',
                'es': 'Spanish',
                'fr': 'French',
                'de': 'German',
                'it': 'Italian',
                'pt': 'Portuguese'
            };
            return languages[code] || 'English';
        }

        // Open dedicated interface in new tab (restored from yesterday's work)
        function openDedicatedInterface(filename) {
            const url = `/static/${filename}`;
            window.open(url, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');

            // Update status to show interface opened
            const interfaceName = filename.replace('.html', '').replace('-', ' ');
            addSystemMessage(`Opened ${interfaceName} interface in new tab`);
        }

        // Open wizard interface through API endpoint
        function openWizardInterface(wizardType) {
            // Map wizard types to their API endpoint names
            const wizardEndpoints = {
                'clinical_assessment': 'clinical-assessment',
                'medication_reconciliation': 'medication-reconciliation',
                'patient_education': 'patient-education',
                'quality_improvement': 'quality-improvement',
                'dosage_calculation': 'dosage-calculation',
                'nursing_assessment': 'nursing-assessment',
                'discharge_planning': 'discharge-planning',
                'treatment_plan': 'treatment-plan'
            };

            const endpoint = wizardEndpoints[wizardType] || wizardType;
            const wizardStartUrl = `${API_BASE_URL}/wizard/${endpoint}/start`;

            // Test if wizard API is available
            fetch(wizardStartUrl, { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        // Wizard API exists - for now, start it in chat
                        // TODO: Create dedicated wizard UI pages
                        console.log(`Wizard ${wizardType} is available via API`);
                        startWizardInChat(wizardType);
                    } else {
                        throw new Error('Wizard API not available');
                    }
                })
                .catch(error => {
                    console.warn('Wizard API not available, using chat interface:', error);
                    startWizardInChat(wizardType);
                });
        }

        // Start wizard conversation in chat interface
        function startWizardInChat(wizardType) {
            if (document.getElementById('chatInterface').classList.contains('hidden')) {
                startClinicalChat();
            }
            
            const wizardPrompts = {
                'clinical_assessment': 'I need help with a comprehensive clinical assessment. Can you guide me through the systematic assessment process?',
                'medication_reconciliation': 'I need to perform medication reconciliation for a patient. Can you help me with the step-by-step process?',
                'patient_education': 'I need to develop a patient education plan. Can you help me structure the teaching materials?',
                'quality_improvement': 'I want to work on a quality improvement initiative. Can you guide me through the process?',
                'discharge_planning': 'I need assistance with discharge planning. Can you help me ensure all aspects are covered?',
                'nursing_assessment': 'I need to conduct a nursing assessment. Can you walk me through the comprehensive process?',
                'treatment_plan': 'I need help developing a treatment plan. Can you guide me through evidence-based planning?',
                'dosage_calculation': 'I need help with medication dosage calculations. Can you guide me through safe calculation methods and formulas?'
            };

            const prompt = wizardPrompts[wizardType] || `I need help with ${wizardType.replace('_', ' ')}. Can you assist me?`;
            
            setTimeout(() => {
                document.getElementById('messageInput').value = prompt;
                sendMessage();
            }, 100);
        }

        // Switch between main interface tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Activate selected tab
            const activeBtn = document.getElementById(tabName + 'TabBtn');
            if (activeBtn) {
                activeBtn.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeBtn.classList.remove('border-transparent', 'text-gray-500');
            }

            // For now, just scroll to top since we're in the main interface
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>