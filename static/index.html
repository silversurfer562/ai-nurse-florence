<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Nurse Florence - Clinical Decision Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .chat-message { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .typing-indicator { animation: typing 1.5s infinite; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        .clinical-card { transition: all 0.2s ease; }
        .clinical-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-600 p-3 rounded-xl">
                        <i class="fas fa-user-nurse text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">AI Nurse Florence</h1>
                        <p class="text-sm text-blue-600 font-medium">Clinical Decision Support System</p>
                    </div>
                </div>
                
                <!-- Header Controls -->
                <div class="flex items-center space-x-4">
                    <!-- Connection Status -->
                    <div id="connectionStatus" class="flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg">
                        <div class="w-3 h-3 bg-gray-400 rounded-full pulse-dot"></div>
                        <span class="text-sm text-gray-600 font-medium">Connecting...</span>
                    </div>
                    
                    <!-- Language Selector -->
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-globe text-gray-500"></i>
                        <select id="languageSelector" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white">
                            <option value="en">English</option>
                            <option value="es">Español</option>
                            <option value="fr">Français</option>
                            <option value="de">Deutsch</option>
                            <option value="it">Italiano</option>
                            <option value="pt">Português</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-6xl mx-auto px-4 py-6">
        
        <!-- Welcome Banner (shown initially) -->
        <div id="welcomeBanner" class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-lg text-white p-8 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <h2 class="text-2xl font-bold mb-2">Welcome to Your Clinical Assistant</h2>
                    <p class="text-blue-100 mb-4">Get evidence-based support for patient care, medication guidance, and clinical protocols</p>
                    
                    <!-- Compliance Notice -->
                    <div class="bg-blue-500/30 border border-blue-400/30 rounded-lg p-4 mb-4">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-shield-alt text-blue-200 mt-1"></i>
                            <div class="text-sm">
                                <p class="font-semibold text-blue-100 mb-1">Clinical Decision Support Tool</p>
                                <p class="text-blue-200">Educational and reference purposes only. Always follow your institution's protocols and verify all clinical decisions with appropriate healthcare professionals. No PHI is stored or processed.</p>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="startClinicalChat()" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 transition-colors flex items-center space-x-2">
                        <i class="fas fa-comments"></i>
                        <span>Start Clinical Chat</span>
                    </button>
                </div>
                
                <div class="hidden lg:block">
                    <div class="text-right">
                        <div class="bg-white/10 rounded-lg p-4 backdrop-blur">
                            <div class="text-3xl font-bold">v2.0.1</div>
                            <div class="text-blue-200 text-sm">Evidence-Based</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6" aria-label="Tabs">
                    <button onclick="switchTab('chat')" id="chatTabBtn" class="tab-button active py-4 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600">
                        <i class="fas fa-comments mr-2"></i>
                        Clinical Chat
                    </button>
                    <button onclick="openDedicatedInterface('disease-lookup.html')" id="diseaseTabBtn" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="fas fa-search-plus mr-2"></i>
                        Disease Lookup
                        <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                    </button>
                    <button onclick="openDedicatedInterface('drug-interactions.html')" id="drugTabBtn" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="fas fa-pills mr-2"></i>
                        Drug Interactions
                        <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                    </button>
                    <button onclick="openDedicatedInterface('clinical-workspace.html')" id="workspaceTabBtn" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="fas fa-stethoscope mr-2"></i>
                        Clinical Workspace
                        <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                    </button>
                    <button onclick="openDedicatedInterface('clinical-assessment-optimizer.html')" id="optimizerTabBtn" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="fas fa-brain mr-2"></i>
                        Assessment Optimizer
                        <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                    </button>
                    <button onclick="openDedicatedInterface('sbar-wizard.html')" id="sbarWizardTabBtn" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="fas fa-comments-medical mr-2"></i>
                        SBAR Wizard
                        <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                    </button>
                    <button onclick="openDedicatedInterface('care-plan-wizard.html')" id="carePlanWizardTabBtn" class="tab-button py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        <i class="fas fa-clipboard-check mr-2"></i>
                        Care Plan Wizard
                        <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                    </button>
                </nav>
            </div>
        </div>

        <!-- Chat Tab Content (default) -->
        <div id="chatTab" class="tab-content">
        <!-- Welcome Banner (shown initially) -->
        <div id="welcomeBanner" class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-lg text-white p-8 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <h2 class="text-2xl font-bold mb-2">Welcome to Your Clinical Assistant</h2>
                    <p class="text-blue-100 mb-4">Get evidence-based support for patient care, medication guidance, and clinical protocols</p>
                    
                    <!-- Compliance Notice -->
                    <div class="bg-blue-500/30 border border-blue-400/30 rounded-lg p-4 mb-4">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-shield-alt text-blue-200 mt-1"></i>
                            <div class="text-sm">
                                <p class="font-semibold text-blue-100 mb-1">Clinical Decision Support Tool</p>
                                <p class="text-blue-200">Educational and reference purposes only. Always follow your institution's protocols and verify all clinical decisions with appropriate healthcare professionals. No PHI is stored or processed.</p>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="startClinicalChat()" class="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 transition-colors flex items-center space-x-2">
                        <i class="fas fa-comments"></i>
                        <span>Start Clinical Chat</span>
                    </button>
                </div>
                
                <div class="hidden lg:block">
                    <div class="text-right">
                        <div class="bg-white/10 rounded-lg p-4 backdrop-blur">
                            <div class="text-3xl font-bold">v2.0.1</div>
                            <div class="text-blue-200 text-sm">Evidence-Based</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="quickAccessSection" class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <!-- Emergency Assessment -->
            <div class="clinical-card bg-red-50 border-2 border-red-200 rounded-xl p-6 cursor-pointer hover:border-red-400" onclick="quickClinicalQuery('Emergency assessment protocols for sepsis recognition')">
                <div class="text-center">
                    <div class="bg-red-100 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg text-gray-800 mb-2">Emergency Assessment</h3>
                    <p class="text-sm text-gray-600">Rapid assessment protocols, warning signs, critical interventions</p>
                </div>
            </div>

            <!-- Medication Management -->
            <div class="clinical-card bg-blue-50 border-2 border-blue-200 rounded-xl p-6 cursor-pointer hover:border-blue-400" onclick="quickClinicalQuery('Safe medication administration and dosage calculations')">
                <div class="text-center">
                    <div class="bg-blue-100 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-pills text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg text-gray-800 mb-2">Medication Safety</h3>
                    <p class="text-sm text-gray-600">Administration protocols, dosage calculations, drug interactions</p>
                </div>
            </div>

            <!-- Patient Care Plans -->
            <div class="clinical-card bg-green-50 border-2 border-green-200 rounded-xl p-6 cursor-pointer hover:border-green-400" onclick="quickClinicalQuery('Create nursing care plan for post-operative patient')">
                <div class="text-center">
                    <div class="bg-green-100 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-clipboard-list text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg text-gray-800 mb-2">Care Planning</h3>
                    <p class="text-sm text-gray-600">Nursing diagnoses, interventions, outcome evaluation</p>
                </div>
            </div>

            <!-- Clinical Documentation -->
            <div class="clinical-card bg-purple-50 border-2 border-purple-200 rounded-xl p-6 cursor-pointer hover:border-purple-400" onclick="quickClinicalQuery('SBAR communication template for patient handoff')">
                <div class="text-center">
                    <div class="bg-purple-100 p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-file-medical-alt text-purple-600 text-2xl"></i>
                    </div>
                    <h3 class="font-bold text-lg text-gray-800 mb-2">Documentation</h3>
                    <p class="text-sm text-gray-600">SBAR reports, nursing notes, handoff communication</p>
                </div>
            </div>
        </div>

        <!-- Advanced Clinical Tools (shown initially) -->
        <div id="advancedToolsSection" class="grid md:grid-cols-2 gap-6 mb-8">
            <!-- Disease Lookup Tool -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-200">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="bg-orange-100 p-3 rounded-lg">
                            <i class="fas fa-search-plus text-orange-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">Disease Lookup</h3>
                            <p class="text-sm text-gray-600">Search for disease information, symptoms, and clinical data</p>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Search Disease</label>
                            <input 
                                type="text" 
                                id="diseaseSearchInput"
                                placeholder="Enter disease name (e.g., diabetes, hypertension, pneumonia)"
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                onkeypress="handleDiseaseSearchKeyPress(event)"
                            >
                        </div>
                        <button 
                            onclick="searchDisease()"
                            class="w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors flex items-center justify-center space-x-2"
                        >
                            <i class="fas fa-search"></i>
                            <span>Search Disease</span>
                        </button>
                        <div id="diseaseResults" class="hidden mt-4 p-4 bg-orange-50 rounded-lg border border-orange-200">
                            <!-- Disease results will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Drug Interaction Checker -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-200">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="bg-indigo-100 p-3 rounded-lg">
                            <i class="fas fa-pills text-indigo-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold text-gray-800">Drug Interaction Checker</h3>
                            <p class="text-sm text-gray-600">Check for interactions between medications</p>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Medications</label>
                            <div id="drugInputContainer" class="space-y-2">
                                <input 
                                    type="text" 
                                    placeholder="Enter medication #1 (e.g., lisinopril, metformin)"
                                    class="drug-input w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                >
                                <input 
                                    type="text" 
                                    placeholder="Enter medication #2"
                                    class="drug-input w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                >
                            </div>
                            <button 
                                onclick="addDrugInput()"
                                class="mt-2 text-indigo-600 text-sm hover:text-indigo-800 flex items-center space-x-1"
                            >
                                <i class="fas fa-plus"></i>
                                <span>Add another medication</span>
                            </button>
                        </div>
                        <button 
                            onclick="checkDrugInteractions()"
                            class="w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-2"
                        >
                            <i class="fas fa-check-circle"></i>
                            <span>Check Interactions</span>
                        </button>
                        <div id="drugInteractionResults" class="hidden mt-4 p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                            <!-- Drug interaction results will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Interface (hidden initially) -->
        <div id="chatInterface" class="hidden">
            <!-- Chat Header -->
            <div class="bg-white rounded-t-xl shadow-lg p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-blue-600 p-2 rounded-lg">
                            <i class="fas fa-user-nurse text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">Clinical Decision Support</h3>
                            <p class="text-sm text-gray-600">Evidence-based nursing guidance</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="showDashboard()" class="text-gray-600 hover:text-blue-600 transition-colors">
                            <i class="fas fa-home mr-2"></i>Dashboard
                        </button>
                        <button onclick="clearChat()" class="text-gray-600 hover:text-red-600 transition-colors">
                            <i class="fas fa-trash-alt mr-2"></i>Clear Chat
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="bg-white shadow-lg">
                <div id="chatMessages" class="h-96 overflow-y-auto p-6 space-y-4">
                    <!-- Messages will be inserted here -->
                </div>
                
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-6 py-2 border-t border-gray-100">
                    <div class="flex items-center space-x-2 text-gray-500">
                        <div class="typing-indicator">
                            <i class="fas fa-circle text-xs"></i>
                            <i class="fas fa-circle text-xs mx-1"></i>
                            <i class="fas fa-circle text-xs"></i>
                        </div>
                        <span class="text-sm">Florence is analyzing...</span>
                    </div>
                </div>
            </div>
                
            <!-- Input Area -->
            <div class="bg-white rounded-b-xl shadow-lg p-6 border-t border-gray-200">
                <div class="flex space-x-4">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Ask about patient assessment, medications, procedures, or clinical protocols..."
                        class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                        onkeypress="handleKeyPress(event)"
                    >
                    <button 
                        id="sendButton"
                        onclick="sendMessage()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg transition-colors duration-200 flex items-center space-x-2 font-medium"
                    >
                        <i class="fas fa-paper-plane"></i>
                        <span>Send</span>
                    </button>
                </div>
                
                <!-- Clinical Quick Actions -->
                <div class="mt-4">
                    <p class="text-xs text-gray-500 mb-2 font-medium">QUICK CLINICAL ACTIONS:</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="quickClinicalQuery('Signs and symptoms of sepsis with qSOFA scoring')" class="bg-red-100 text-red-700 px-3 py-2 rounded-lg text-xs hover:bg-red-200 transition-colors font-medium">
                            <i class="fas fa-thermometer-half mr-1"></i>Sepsis Assessment
                        </button>
                        <button onclick="quickClinicalQuery('Medication calculation: safe dosing and administration')" class="bg-blue-100 text-blue-700 px-3 py-2 rounded-lg text-xs hover:bg-blue-200 transition-colors font-medium">
                            <i class="fas fa-calculator mr-1"></i>Dosage Calc
                        </button>
                        <button onclick="quickClinicalQuery('Pain assessment scales and management protocols')" class="bg-orange-100 text-orange-700 px-3 py-2 rounded-lg text-xs hover:bg-orange-200 transition-colors font-medium">
                            <i class="fas fa-hand-holding-heart mr-1"></i>Pain Management
                        </button>
                        <button onclick="quickClinicalQuery('Fall risk assessment and prevention strategies')" class="bg-yellow-100 text-yellow-700 px-3 py-2 rounded-lg text-xs hover:bg-yellow-200 transition-colors font-medium">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Fall Prevention
                        </button>
                        <button onclick="quickClinicalQuery('Wound assessment and dressing selection guidelines')" class="bg-green-100 text-green-700 px-3 py-2 rounded-lg text-xs hover:bg-green-200 transition-colors font-medium">
                            <i class="fas fa-band-aid mr-1"></i>Wound Care
                        </button>
                        <button onclick="quickClinicalQuery('IV therapy: insertion, maintenance, and complications')" class="bg-purple-100 text-purple-700 px-3 py-2 rounded-lg text-xs hover:bg-purple-200 transition-colors font-medium">
                            <i class="fas fa-syringe mr-1"></i>IV Therapy
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Disease Lookup Tab Content -->
        <div id="diseaseTab" class="tab-content hidden">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-blue-700 mb-6">
                    <i class="fas fa-search-plus"></i>
                    Disease Information Lookup
                </h2>
                <p class="text-gray-600 mb-6">Search for comprehensive disease information from live medical databases with local fallback.</p>
                
                <!-- Disease Search Form -->
                <div class="mb-6">
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <label for="diseaseSearchTab" class="block text-sm font-medium text-gray-700 mb-2">
                                Disease Name or Symptom
                            </label>
                            <input type="text" 
                                   id="diseaseSearchTab" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="e.g., diabetes, hypertension, chest pain..."
                                   autocomplete="off"
                                   onkeypress="handleDiseaseTabKeyPress(event)">
                            <div id="diseaseTabAutocomplete" class="autocomplete-results" style="display: none;"></div>
                        </div>
                        <button onclick="searchDiseaseTab()" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                    </div>
                    
                    <!-- Advanced Options -->
                    <div class="mt-4">
                        <label class="flex items-center text-sm text-gray-600">
                            <input type="checkbox" id="includeSymptoms" checked class="mr-2">
                            Include symptoms and signs
                        </label>
                        <label class="flex items-center text-sm text-gray-600 mt-1">
                            <input type="checkbox" id="includeTreatments" checked class="mr-2">
                            Include treatment options
                        </label>
                    </div>
                </div>

                <!-- Disease Results -->
                <div id="diseaseTabResults" class="disease-results" style="display: none;">
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">
                            <i class="fas fa-info-circle"></i>
                            Disease Information
                        </h3>
                        <div id="diseaseTabContent" class="space-y-4"></div>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="diseaseTabLoading" class="text-center py-8" style="display: none;">
                    <i class="fas fa-spinner fa-spin text-2xl text-blue-600 mb-2"></i>
                    <p class="text-gray-600">Searching live medical databases...</p>
                </div>
            </div>
        </div>

        <!-- Drug Interaction Checker Tab Content -->
        <div id="drugTab" class="tab-content hidden">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-purple-700 mb-6">
                    <i class="fas fa-pills"></i>
                    Drug Interaction Checker
                </h2>
                <p class="text-gray-600 mb-6">Check for potential interactions between medications using live FDA data and clinical databases.</p>
                
                <!-- Drug Input Form -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Enter Medications (one per line or comma-separated)
                    </label>
                    <div class="space-y-4">
                        <div class="drug-input-group">
                            <input type="text" 
                                   id="drug1Tab" 
                                   class="drug-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   placeholder="e.g., Warfarin, Aspirin, Metformin..."
                                   autocomplete="off">
                            <div id="drug1TabAutocomplete" class="autocomplete-results" style="display: none;"></div>
                        </div>
                        <div class="drug-input-group">
                            <input type="text" 
                                   id="drug2Tab" 
                                   class="drug-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   placeholder="Second medication (optional)..."
                                   autocomplete="off">
                            <div id="drug2TabAutocomplete" class="autocomplete-results" style="display: none;"></div>
                        </div>
                        <div id="additionalDrugInputs"></div>
                        <button onclick="addDrugInputTab()" 
                                class="text-sm text-purple-600 hover:text-purple-800">
                            <i class="fas fa-plus"></i>
                            Add another medication
                        </button>
                    </div>
                    
                    <div class="mt-4 flex gap-4">
                        <button onclick="checkDrugInteractionsTab()" 
                                class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-search"></i>
                            Check Interactions
                        </button>
                        <button onclick="clearDrugInputsTab()" 
                                class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            <i class="fas fa-times"></i>
                            Clear All
                        </button>
                    </div>
                </div>

                <!-- Drug Interaction Results -->
                <div id="drugTabResults" class="drug-results" style="display: none;">
                    <div id="drugTabContent" class="space-y-4"></div>
                </div>

                <!-- Drug Loading State -->
                <div id="drugTabLoading" class="text-center py-8" style="display: none;">
                    <i class="fas fa-spinner fa-spin text-2xl text-purple-600 mb-2"></i>
                    <p class="text-gray-600">Checking FDA database and clinical resources...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">
                    <p class="font-medium">AI Nurse Florence v2.0.1</p>
                    <p class="text-xs text-gray-500 mt-1">Clinical Decision Support System</p>
                </div>
                <div class="flex items-center space-x-4 text-xs text-gray-500">
                    <span><i class="fas fa-shield-alt mr-1"></i>Evidence-Based</span>
                    <span><i class="fas fa-user-graduate mr-1"></i>Educational Tool</span>
                    <span><i class="fas fa-lock mr-1"></i>No PHI Stored</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Configuration - Update this to match your Railway deployment
        const API_BASE_URL = window.location.origin + '/api/v1';
        let currentLanguage = 'en';

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkApiConnection();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('languageSelector').addEventListener('change', function(e) {
                currentLanguage = e.target.value;
                addSystemMessage(`Language changed to ${getLanguageName(e.target.value)}`);
            });
        }

        // Check API connection
        async function checkApiConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const data = await response.json();
                
                if (data.status === 'operational') {
                    updateConnectionStatus('connected', 'System Online');
                } else {
                    throw new Error('API not operational');
                }
            } catch (error) {
                console.error('API connection failed:', error);
                updateConnectionStatus('error', 'System Offline');
            }
        }

        // Update connection status
        function updateConnectionStatus(status, text) {
            const statusEl = document.getElementById('connectionStatus');
            const dot = statusEl.querySelector('.pulse-dot');
            const span = statusEl.querySelector('span');
            
            dot.className = 'w-3 h-3 rounded-full pulse-dot';
            statusEl.className = 'flex items-center space-x-2 px-3 py-2 rounded-lg';
            
            switch (status) {
                case 'connected':
                    dot.classList.add('bg-green-500');
                    span.textContent = text;
                    span.className = 'text-sm text-green-700 font-medium';
                    statusEl.classList.add('bg-green-50');
                    break;
                case 'error':
                    dot.classList.add('bg-red-500');
                    span.textContent = text;
                    span.className = 'text-sm text-red-700 font-medium';
                    statusEl.classList.add('bg-red-50');
                    break;
                default:
                    dot.classList.add('bg-gray-400');
                    span.textContent = text;
                    span.className = 'text-sm text-gray-600 font-medium';
                    statusEl.classList.add('bg-gray-50');
            }
        }

        // Start clinical chat
        function startClinicalChat() {
            document.getElementById('welcomeBanner').classList.add('hidden');
            document.getElementById('quickAccessSection').classList.add('hidden');
            document.getElementById('chatInterface').classList.remove('hidden');
            
            // Add clinical welcome message
            addAssistantMessage("Hello! I'm AI Nurse Florence, your clinical decision support assistant. I'm here to help with evidence-based nursing guidance, patient assessment protocols, medication safety, and clinical decision-making.\n\nI can assist with:\n• Patient assessment and monitoring\n• Medication calculations and safety\n• Clinical protocols and procedures\n• Documentation and communication\n• Emergency response protocols\n\nWhat clinical question can I help you with today?");
            
            // Focus the input
            document.getElementById('messageInput').focus();
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('welcomeBanner').classList.remove('hidden');
            document.getElementById('quickAccessSection').classList.remove('hidden');
            document.getElementById('chatInterface').classList.add('hidden');
            clearChatMessages();
        }

        // Clear chat
        function clearChat() {
            clearChatMessages();
            addAssistantMessage("Chat cleared. How can I assist you with your clinical practice today?");
        }

        // Clear chat messages
        function clearChatMessages() {
            document.getElementById('chatMessages').innerHTML = '';
        }

        // Add assistant message
        function addAssistantMessage(content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex justify-start mb-6';
            
            messageDiv.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg px-4 py-3 max-w-4xl">
                    <div class="flex items-center mb-2">
                        <div class="bg-blue-600 p-1 rounded-full mr-2">
                            <i class="fas fa-user-nurse text-white text-xs"></i>
                        </div>
                        <span class="text-xs text-blue-700 font-medium">AI Nurse Florence</span>
                        <span class="text-xs text-gray-500 ml-2">Clinical Assistant</span>
                    </div>
                    <div class="text-sm text-gray-800 whitespace-pre-line">${content}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Add user message
        function addUserMessage(content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex justify-end mb-6';
            
            messageDiv.innerHTML = `
                <div class="bg-blue-600 text-white rounded-lg px-4 py-3 max-w-md">
                    <div class="flex items-center justify-end mb-2">
                        <span class="text-xs text-blue-100 mr-2">Nurse</span>
                        <div class="bg-blue-500 p-1 rounded-full">
                            <i class="fas fa-user text-white text-xs"></i>
                        </div>
                    </div>
                    <p class="text-sm">${content}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Add system message
        function addSystemMessage(content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex justify-center mb-4';
            
            messageDiv.innerHTML = `
                <div class="bg-gray-100 text-gray-700 rounded-full px-4 py-2 text-xs">
                    <i class="fas fa-info-circle mr-1"></i>${content}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Handle key press in input
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Quick clinical query
        function quickClinicalQuery(query) {
            if (document.getElementById('chatInterface').classList.contains('hidden')) {
                startClinicalChat();
                setTimeout(() => {
                    document.getElementById('messageInput').value = query;
                    sendMessage();
                }, 100);
            } else {
                document.getElementById('messageInput').value = query;
                sendMessage();
            }
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addUserMessage(message);
            
            // Clear input and disable send button
            input.value = '';
            sendButton.disabled = true;
            sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Analyzing...</span>';
            
            // Show typing indicator
            document.getElementById('typingIndicator').classList.remove('hidden');
            
            try {
                // Try to make real API call first
                const response = await fetch(`${API_BASE_URL}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        language: currentLanguage
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    addAssistantMessage(data.response || data.message || 'Response received');
                } else {
                    throw new Error('API call failed');
                }
                
            } catch (error) {
                console.warn('API call failed, using simulated response:', error);
                // Fall back to simulated response for testing
                await simulateClinicalApiCall(message);
            } finally {
                // Re-enable send button and hide typing indicator
                sendButton.disabled = false;
                sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> <span>Send</span>';
                document.getElementById('typingIndicator').classList.add('hidden');
                input.focus();
            }
        }

        // Simulate clinical API call with nursing-specific responses (for testing when API is not ready)
        async function simulateClinicalApiCall(message) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    let response = generateClinicalResponse(message);
                    addAssistantMessage(response);
                    resolve();
                }, 1500);
            });
        }

        // Generate clinical response for testing
        function generateClinicalResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('sepsis')) {
                return "**Sepsis Recognition & Response Protocol:**\n\n**qSOFA Screening (≥2 points suggests sepsis):**\n• Altered mental status (GCS <15)\n• Systolic BP ≤100 mmHg\n• Respiratory rate ≥22/min\n\n**SIRS Criteria (≥2 suggests infection):**\n• Temperature >38°C or <36°C\n• Heart rate >90 bpm\n• Respiratory rate >20/min\n• WBC >12,000 or <4,000\n\n**Immediate Nursing Actions:**\n1. Obtain blood cultures before antibiotics\n2. Start broad-spectrum antibiotics within 1 hour\n3. Administer 30ml/kg crystalloid if hypotensive\n4. Monitor lactate levels\n5. Ensure adequate oxygenation\n6. Frequent vital signs and neurological checks\n\n**Critical Alert:** Activate sepsis protocol and notify physician immediately for any positive screening.";
                        
            } else if (lowerMessage.includes('medication') || lowerMessage.includes('dosage')) {
                return "**Medication Safety & Calculation Protocol:**\n\n**Five Rights of Medication Administration:**\n• Right Patient (2 identifiers)\n• Right Drug (generic & brand names)\n• Right Dose (calculate and verify)\n• Right Route (PO, IV, IM, SQ, etc.)\n• Right Time (scheduled vs PRN)\n\n**Dosage Calculation Formula:**\n**Dose = (Desired dose × Volume) ÷ Stock strength**\n\nExample: Order 400mg, Stock 200mg/5ml\n= (400 × 5) ÷ 200 = 10ml\n\n**Critical Safety Checks:**\n1. Verify allergies and contraindications\n2. Check drug interactions\n3. Assess patient's current condition\n4. Double-check high-risk medications\n5. Monitor for adverse effects\n6. Document immediately after administration\n\n**High-Alert Medications:** Always use independent double-checks for insulin, heparin, chemotherapy, and vasoactive drugs.";
                        
            } else {
                return `I understand you're asking about "${message}". As your AI healthcare assistant, I'd be happy to provide evidence-based information. Could you provide more specific details about what aspect you'd like me to focus on? This helps me give you the most relevant and useful information for your nursing practice.\n\n**Note:** This is a testing prototype. The API will provide more comprehensive responses when fully connected.`;
            }
        }

        // Get language name
        function getLanguageName(code) {
            const languages = {
                'en': 'English',
                'es': 'Spanish',
                'fr': 'French',
                'de': 'German',
                'it': 'Italian',
                'pt': 'Portuguese'
            };
            return languages[code] || 'English';
        }

        // Open dedicated interface in new tab (restored from yesterday's work)
        function openDedicatedInterface(filename) {
            const url = `./${filename}`;
            window.open(url, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
            
            // Update status to show interface opened
            const interfaceName = filename.replace('.html', '').replace('-', ' ');
            const statusElement = document.querySelector('.status-indicator');
            if (statusElement) {
                statusElement.textContent = `Opened ${interfaceName} interface`;
                setTimeout(() => {
                    statusElement.textContent = 'Connected';
                }, 3000);
            }
        }

        // Switch between main interface tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Activate selected tab
            const activeBtn = document.getElementById(tabName + 'TabBtn');
            if (activeBtn) {
                activeBtn.classList.add('active', 'border-blue-500', 'text-blue-600');
                activeBtn.classList.remove('border-transparent', 'text-gray-500');
            }

            // For now, just scroll to top since we're in the main interface
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>