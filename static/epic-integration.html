<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic EHR Integration - AI Nurse Florence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #reader { border-radius: 12px; overflow: hidden; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-600 p-3 rounded-xl">
                        <i class="fas fa-user-nurse text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">AI Nurse Florence</h1>
                        <p class="text-sm text-blue-600 font-medium">Epic EHR Integration</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Epic Connection Status -->
                    <div id="epicStatus" class="flex items-center space-x-2 bg-gray-50 px-4 py-2 rounded-lg">
                        <div class="w-3 h-3 bg-gray-400 rounded-full pulse-dot"></div>
                        <span class="text-sm text-gray-600 font-medium">Checking...</span>
                    </div>

                    <button onclick="window.location.href='/'" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-6">

        <!-- Epic Integration Notice -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-lg text-white p-6 mb-6">
            <div class="flex items-start space-x-4">
                <div class="bg-blue-500/30 p-3 rounded-lg">
                    <i class="fas fa-shield-alt text-2xl"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold mb-2">AI Nurse Florence Ã— Epic EHR</h2>
                    <p class="text-blue-100 text-sm mb-3">Seamlessly retrieve patient demographics, active conditions, and medications directly from your Epic EHR system using HL7 FHIR R4 standards. Powered by AI Nurse Florence clinical decision support.</p>
                    <div class="flex items-center space-x-4 text-sm">
                        <span><i class="fas fa-lock mr-1"></i>OAuth 2.0 Secured</span>
                        <span><i class="fas fa-check-circle mr-1"></i>HIPAA Compliant</span>
                        <span><i class="fas fa-database mr-1"></i>Session-Only Storage</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div class="grid lg:grid-cols-3 gap-6">

            <!-- Left Column: Patient Lookup -->
            <div class="lg:col-span-2 space-y-6">

                <!-- MRN Lookup Card -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-search text-blue-600 mr-2"></i>
                            Patient Lookup
                        </h2>
                        <div class="flex space-x-2">
                            <button id="manualInputBtn" onclick="switchLookupMethod('manual')" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-keyboard mr-1"></i>Manual Entry
                            </button>
                            <button id="scanInputBtn" onclick="switchLookupMethod('scan')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300 transition-colors">
                                <i class="fas fa-barcode mr-1"></i>Scan Barcode
                            </button>
                        </div>
                    </div>

                    <!-- Manual MRN Input -->
                    <div id="manualInput" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Medical Record Number (MRN)
                            </label>
                            <div class="flex space-x-2">
                                <input
                                    type="text"
                                    id="mrnInput"
                                    placeholder="Enter 8-digit MRN (e.g., 12345678)"
                                    class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    onkeypress="handleMrnKeyPress(event)"
                                    maxlength="15"
                                >
                                <button
                                    onclick="lookupPatient()"
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center space-x-2"
                                >
                                    <i class="fas fa-search"></i>
                                    <span>Lookup</span>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Test MRNs: 12345678 (John Smith), 87654321 (Sarah Johnson)
                            </p>
                        </div>
                    </div>

                    <!-- Barcode Scanner -->
                    <div id="scanInput" class="hidden space-y-4">
                        <div class="bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div id="reader" class="w-full"></div>
                            <div id="scanPlaceholder" class="text-center py-12">
                                <i class="fas fa-barcode text-6xl text-gray-400 mb-4"></i>
                                <p class="text-gray-600 font-medium mb-2">Position barcode in camera view</p>
                                <p class="text-sm text-gray-500">Supports Code 128, Code 39, QR codes</p>
                                <button id="startScanBtn" onclick="startBarcodeScanner()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-camera mr-2"></i>Start Camera
                                </button>
                            </div>
                        </div>
                        <div id="scanResult" class="hidden bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                                    <div>
                                        <p class="text-sm font-medium text-gray-800">Barcode Scanned</p>
                                        <p id="scannedMrn" class="text-xs text-gray-600"></p>
                                    </div>
                                </div>
                                <button onclick="lookupScannedPatient()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
                                    Lookup Patient
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-6 text-center">
                        <i class="fas fa-spinner fa-spin text-blue-600 text-3xl mb-3"></i>
                        <p class="text-blue-800 font-medium">Retrieving patient data from Epic...</p>
                        <p class="text-blue-600 text-sm mt-1">This may take a few seconds</p>
                    </div>

                    <!-- Error State -->
                    <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
                            <div class="flex-1">
                                <p class="text-red-800 font-medium">Error Retrieving Patient</p>
                                <p id="errorMessage" class="text-red-600 text-sm mt-1"></p>
                            </div>
                            <button onclick="clearError()" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Patient Details Card -->
                <div id="patientDetails" class="hidden bg-white rounded-xl shadow-lg p-6 fade-in">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-user-circle text-blue-600 mr-2"></i>
                            Patient Information
                        </h2>
                        <button onclick="autofillPatientData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            <i class="fas fa-check-double mr-2"></i>Auto-fill Forms
                        </button>
                    </div>

                    <!-- Patient Demographics -->
                    <div class="grid md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h3 class="text-sm font-medium text-gray-500 mb-3">Demographics</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Name:</span>
                                    <span id="patientName" class="text-sm font-medium text-gray-800"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">MRN:</span>
                                    <span id="patientMrn" class="text-sm font-medium text-gray-800"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Date of Birth:</span>
                                    <span id="patientDob" class="text-sm font-medium text-gray-800"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Gender:</span>
                                    <span id="patientGender" class="text-sm font-medium text-gray-800"></span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-sm font-medium text-gray-500 mb-3">Source</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">FHIR ID:</span>
                                    <span id="patientFhirId" class="text-sm font-mono text-gray-800"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Source:</span>
                                    <span class="text-sm font-medium text-blue-600">Epic EHR</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Retrieved:</span>
                                    <span id="retrievalTime" class="text-sm text-gray-800"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Conditions -->
                    <div class="mb-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">
                            <i class="fas fa-notes-medical text-orange-600 mr-2"></i>
                            Active Conditions
                        </h3>
                        <div id="conditionsList" class="space-y-2">
                            <!-- Conditions will be inserted here -->
                        </div>
                    </div>

                    <!-- Active Medications -->
                    <div>
                        <h3 class="text-sm font-medium text-gray-700 mb-3">
                            <i class="fas fa-pills text-blue-600 mr-2"></i>
                            Active Medications
                        </h3>
                        <div id="medicationsList" class="space-y-2">
                            <!-- Medications will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Info & Settings -->
            <div class="space-y-6">

                <!-- Connection Info -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                        Connection Info
                    </h3>
                    <div class="space-y-3 text-sm">
                        <div>
                            <span class="text-gray-600">Endpoint:</span>
                            <p id="epicEndpoint" class="text-gray-800 font-mono text-xs mt-1 break-all"></p>
                        </div>
                        <div>
                            <span class="text-gray-600">Environment:</span>
                            <p id="epicEnvironment" class="text-gray-800 font-medium mt-1"></p>
                        </div>
                        <div>
                            <span class="text-gray-600">FHIR Version:</span>
                            <p class="text-gray-800 font-medium mt-1">R4</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-bolt text-yellow-600 mr-2"></i>
                        Quick Actions
                    </h3>
                    <div class="space-y-2">
                        <button onclick="window.location.href='/static/epic-wizard.html'" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white px-4 py-3 rounded-lg text-sm font-medium transition-all shadow-md hover:shadow-lg text-left flex items-center justify-between">
                            <span><i class="fas fa-magic mr-2"></i>Setup Wizard</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                        <button onclick="testEpicConnection()" class="w-full bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-left">
                            <i class="fas fa-plug mr-2"></i>Test Connection
                        </button>
                        <button onclick="viewRecentLookups()" class="w-full bg-gray-50 hover:bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-left">
                            <i class="fas fa-history mr-2"></i>Recent Lookups
                        </button>
                        <button onclick="viewDocumentation()" class="w-full bg-blue-50 hover:bg-blue-100 text-blue-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-left">
                            <i class="fas fa-book mr-2"></i>Documentation
                        </button>
                    </div>
                </div>

                <!-- Help Card -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-50 rounded-xl p-6 border border-blue-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">
                        <i class="fas fa-question-circle text-blue-600 mr-2"></i>
                        How to Use
                    </h3>
                    <ol class="space-y-2 text-sm text-gray-700">
                        <li class="flex items-start">
                            <span class="bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5">1</span>
                            <span>Enter patient MRN or scan barcode</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5">2</span>
                            <span>Review patient demographics and conditions</span>
                        </li>
                        <li class="flex items-start">
                            <span class="bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs mr-2 mt-0.5">3</span>
                            <span>Click "Auto-fill Forms" to populate data</span>
                        </li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = window.location.origin + '/api/v1';
        let currentPatientData = null;
        let html5QrCode = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkEpicConnection();
        });

        // Check Epic connection status
        async function checkEpicConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/ehr/epic/status`);
                const data = await response.json();

                if (data.status === 'connected' || data.status === 'available') {
                    updateEpicStatus('connected', 'Epic Connected');
                    document.getElementById('epicEndpoint').textContent = data.endpoint || 'Mock Server';
                    document.getElementById('epicEnvironment').textContent = data.environment || 'Development';
                } else {
                    throw new Error('Epic not available');
                }
            } catch (error) {
                console.error('Epic connection check failed:', error);
                updateEpicStatus('disconnected', 'Epic Unavailable');
                document.getElementById('epicEndpoint').textContent = 'Not configured';
                document.getElementById('epicEnvironment').textContent = 'Offline';
            }
        }

        // Update Epic status indicator
        function updateEpicStatus(status, text) {
            const statusEl = document.getElementById('epicStatus');
            const dot = statusEl.querySelector('.pulse-dot');
            const span = statusEl.querySelector('span');

            dot.className = 'w-3 h-3 rounded-full pulse-dot';
            statusEl.className = 'flex items-center space-x-2 px-4 py-2 rounded-lg';

            if (status === 'connected') {
                dot.classList.add('bg-green-500');
                span.textContent = text;
                span.className = 'text-sm text-green-700 font-medium';
                statusEl.classList.add('bg-green-50');
            } else {
                dot.classList.add('bg-red-500');
                span.textContent = text;
                span.className = 'text-sm text-red-700 font-medium';
                statusEl.classList.add('bg-red-50');
            }
        }

        // Switch lookup method
        function switchLookupMethod(method) {
            if (method === 'manual') {
                document.getElementById('manualInput').classList.remove('hidden');
                document.getElementById('scanInput').classList.add('hidden');
                document.getElementById('manualInputBtn').classList.remove('bg-gray-200', 'text-gray-700');
                document.getElementById('manualInputBtn').classList.add('bg-blue-600', 'text-white');
                document.getElementById('scanInputBtn').classList.remove('bg-blue-600', 'text-white');
                document.getElementById('scanInputBtn').classList.add('bg-gray-200', 'text-gray-700');
                stopBarcodeScanner();
            } else {
                document.getElementById('manualInput').classList.add('hidden');
                document.getElementById('scanInput').classList.remove('hidden');
                document.getElementById('scanInputBtn').classList.remove('bg-gray-200', 'text-gray-700');
                document.getElementById('scanInputBtn').classList.add('bg-blue-600', 'text-white');
                document.getElementById('manualInputBtn').classList.remove('bg-blue-600', 'text-white');
                document.getElementById('manualInputBtn').classList.add('bg-gray-200', 'text-gray-700');
            }
        }

        // Handle MRN input key press
        function handleMrnKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                lookupPatient();
            }
        }

        // Lookup patient by MRN
        async function lookupPatient() {
            const mrn = document.getElementById('mrnInput').value.trim();

            if (!mrn) {
                showError('Please enter a valid MRN');
                return;
            }

            // Show loading state
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('patientDetails').classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/ehr/patient/lookup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ identifier: mrn, identifier_type: 'mrn' })
                });

                if (!response.ok) {
                    throw new Error('Patient not found or Epic error');
                }

                const data = await response.json();
                currentPatientData = data;
                displayPatientData(data);

            } catch (error) {
                console.error('Patient lookup failed:', error);
                showError('Patient not found. Please verify the MRN and try again.');
            } finally {
                document.getElementById('loadingState').classList.add('hidden');
            }
        }

        // Display patient data
        function displayPatientData(data) {
            // Hide error and show patient details
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('patientDetails').classList.remove('hidden');

            // Demographics
            const fullName = `${data.patient.given_name} ${data.patient.family_name}`;
            document.getElementById('patientName').textContent = fullName;
            document.getElementById('patientMrn').textContent = data.patient.mrn;
            document.getElementById('patientDob').textContent = data.patient.date_of_birth || 'N/A';
            document.getElementById('patientGender').textContent = data.patient.gender || 'N/A';
            document.getElementById('patientFhirId').textContent = data.patient.fhir_id || 'N/A';
            document.getElementById('retrievalTime').textContent = new Date().toLocaleTimeString();

            // Conditions
            const conditionsList = document.getElementById('conditionsList');
            conditionsList.innerHTML = '';

            if (data.conditions && data.conditions.length > 0) {
                data.conditions.forEach(condition => {
                    const conditionEl = document.createElement('div');
                    conditionEl.className = 'bg-orange-50 border border-orange-200 rounded-lg p-3';
                    conditionEl.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">${condition.description}</p>
                                ${condition.icd10_code ? `<p class="text-xs text-gray-600 mt-1">ICD-10: ${condition.icd10_code}</p>` : ''}
                            </div>
                            <span class="text-xs font-medium text-orange-700 bg-orange-100 px-2 py-1 rounded">${condition.clinical_status || 'Active'}</span>
                        </div>
                    `;
                    conditionsList.appendChild(conditionEl);
                });
            } else {
                conditionsList.innerHTML = '<p class="text-sm text-gray-500 italic">No active conditions recorded</p>';
            }

            // Medications
            const medicationsList = document.getElementById('medicationsList');
            medicationsList.innerHTML = '';

            if (data.medications && data.medications.length > 0) {
                data.medications.forEach(med => {
                    const medEl = document.createElement('div');
                    medEl.className = 'bg-blue-50 border border-blue-200 rounded-lg p-3';
                    medEl.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">${med.medication_name}</p>
                                ${med.dosage ? `<p class="text-xs text-gray-600 mt-1">Dosage: ${med.dosage}</p>` : ''}
                            </div>
                            <span class="text-xs font-medium text-blue-700 bg-blue-100 px-2 py-1 rounded">${med.status || 'Active'}</span>
                        </div>
                    `;
                    medicationsList.appendChild(medEl);
                });
            } else {
                medicationsList.innerHTML = '<p class="text-sm text-gray-500 italic">No active medications recorded</p>';
            }

            // Scroll to patient details
            document.getElementById('patientDetails').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Show error message
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorState').classList.remove('hidden');
            document.getElementById('patientDetails').classList.add('hidden');
        }

        // Clear error
        function clearError() {
            document.getElementById('errorState').classList.add('hidden');
        }

        // Start barcode scanner
        async function startBarcodeScanner() {
            try {
                document.getElementById('scanPlaceholder').classList.add('hidden');
                document.getElementById('reader').classList.remove('hidden');

                html5QrCode = new Html5Qrcode("reader");

                await html5QrCode.start(
                    { facingMode: "environment" },
                    {
                        fps: 10,
                        qrbox: { width: 300, height: 150 }
                    },
                    onScanSuccess,
                    onScanFailure
                );
            } catch (err) {
                console.error('Failed to start scanner:', err);
                showError('Camera access denied or not available');
                document.getElementById('scanPlaceholder').classList.remove('hidden');
            }
        }

        // Stop barcode scanner
        function stopBarcodeScanner() {
            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    document.getElementById('reader').classList.add('hidden');
                    document.getElementById('scanPlaceholder').classList.remove('hidden');
                }).catch(err => console.error('Failed to stop scanner:', err));
            }
        }

        // Barcode scan success
        function onScanSuccess(decodedText, decodedResult) {
            console.log('Barcode scanned:', decodedText);

            // Extract MRN from barcode
            let mrn = decodedText;

            // Handle various barcode formats
            if (decodedText.includes('MRN:')) {
                mrn = decodedText.split('MRN:')[1].split(/[^0-9]/)[0];
            } else if (decodedText.includes('^')) {
                const parts = decodedText.split('^');
                const mrnIndex = parts.findIndex(p => p.toUpperCase() === 'MRN');
                if (mrnIndex >= 0 && mrnIndex + 1 < parts.length) {
                    mrn = parts[mrnIndex + 1];
                }
            }

            // Show scan result
            document.getElementById('scannedMrn').textContent = `MRN: ${mrn}`;
            document.getElementById('scanResult').classList.remove('hidden');
            document.getElementById('mrnInput').value = mrn;

            // Stop scanner
            stopBarcodeScanner();
        }

        // Barcode scan failure
        function onScanFailure(error) {
            // Ignore routine scanning errors
        }

        // Lookup scanned patient
        function lookupScannedPatient() {
            lookupPatient();
        }

        // Auto-fill patient data into forms
        function autofillPatientData() {
            if (!currentPatientData) {
                alert('No patient data available to auto-fill');
                return;
            }

            // Store in sessionStorage for other pages to access
            sessionStorage.setItem('epic_patient_data', JSON.stringify(currentPatientData));

            alert('Patient data has been auto-filled! Navigate to any clinical form (SBAR, Care Plan, etc.) to see the data populated automatically.');
        }

        // Test Epic connection
        async function testEpicConnection() {
            const btn = event.target;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';
            btn.disabled = true;

            try {
                await checkEpicConnection();
                alert('Epic connection test successful!');
            } catch (error) {
                alert('Epic connection test failed. Check console for details.');
            } finally {
                btn.innerHTML = '<i class="fas fa-plug mr-2"></i>Test Connection';
                btn.disabled = false;
            }
        }

        // View recent lookups
        function viewRecentLookups() {
            alert('Recent lookups feature coming soon. This will show your recent patient searches for quick re-access.');
        }

        // View documentation
        function viewDocumentation() {
            window.open('/EPIC_DEMO_README.md', '_blank');
        }
    </script>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">
                    <p class="font-medium">AI Nurse Florence - Epic EHR Integration</p>
                    <p class="text-xs text-gray-500 mt-1">Clinical Decision Support System</p>
                </div>
                <div class="flex items-center space-x-4 text-xs text-gray-500">
                    <span><i class="fas fa-shield-alt mr-1"></i>HIPAA Compliant</span>
                    <span><i class="fas fa-user-graduate mr-1"></i>Educational Tool</span>
                    <span><i class="fas fa-lock mr-1"></i>No PHI Stored</span>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
